<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" sizes="32x32" href="logo.png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
          crossorigin="anonymous">
    <title>Sec Pi</title>
    <style>
        .card{
            box-shadow: 5px 5px 2px 1px rgba(0, 0, 125, .2);
            width: 40%;
            position: center;
            margin-left: 25px;
            margin-top:150px;
        }
        li {
            list-style: none;
        }
        btn btn-danger{
            float: left;
        }
        .left {
            width: 50%;
            float: left;
            font-size: large;
            margin-top: 15px;
        }

        .right {
            width: 25%;
            float: right;
            color: white;
        }

    </style>
    <script>
        function displayState() {
            const xmlHttpRequest = new XMLHttpRequest();
            xmlHttpRequest.onreadystatechange = function () {
                if(this.readyState == 4 && this.status === 200){
                    const response = this.responseText;
                    const system = JSON.parse(response);

                    const state = document.createElement("list-group-item");
                    state.setAttribute("id", "system");
                    let left = document.createElement("div");
                    let right1 = document.createElement("div");
                    let right2 = document.createElement("div");
                    left.setAttribute("class", "left");
                    left.innerText = "System State:";
                    right1.setAttribute("class", "right");
                    right2.setAttribute("class", "right");
                    let armed = document.createElement("div");
                    let alarm = document.createElement("div");
                    if(system.alarm){
                        alarm.setAttribute("class", "btn btn-danger");
                    } else{
                        alarm.setAttribute("class", "btn btn-primary");
                    }
                    alarm.innerText = "ALARM";
                    if(system.armed){
                        armed.setAttribute("class", "btn btn-success");
                        armed.innerText = "ARMED";
                    } else{
                        armed.setAttribute("class", "btn btn-info");
                        armed.innerText = "UNARMED";
                    }


                    right1.appendChild(armed);
                    right2.appendChild(alarm);
                    state.appendChild(left);
                    state.appendChild(right1);
                    state.appendChild(right2);

                    const list = document.getElementById("list");
                    list.appendChild(state);
                    list.appendChild(document.createElement("br"));
                    list.appendChild(document.createElement("br"));


                }
            }
            xmlHttpRequest.open("GET", "rest/system/", true);
            xmlHttpRequest.send();

        }

        function displaySensors() {
            list.innerHTML = "";
            const xmlHttpRequest = new XMLHttpRequest();
            xmlHttpRequest.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    const response = this.responseText;
                    const sensors = JSON.parse(response);

                    const list = document.getElementById("list");

                    if (sensors.length > 0) {

                        displayState();

                        for (let i = 0; i < sensors.length; i++) {
                            const sensor = document.createElement("list-group-item");
                            let left = document.createElement("div");
                            let right = document.createElement("div");
                            let rect = document.createElement("div")
                            left.setAttribute("class", "left");
                            right.setAttribute("class", "right");
                            if(sensors[i].open){
                                rect.setAttribute("class", "btn btn-primary");
                                rect.innerText = "OPEN";
                            } else {
                                rect.setAttribute("class", "btn btn-danger");
                                rect.innerText = "CLOSED";
                            }
                            left.innerText = sensors[i].name+":";
                            sensor.appendChild(left);
                            right.appendChild(rect);
                            sensor.appendChild(right);
                            list.appendChild(sensor);
                            list.appendChild(document.createElement("br"));
                            list.appendChild(document.createElement("br"));
                            list.appendChild(document.createElement("br"));
                            list.appendChild(document.createElement("br"));
                        }
                    }
                }
            }
            xmlHttpRequest.open("GET", "rest/sensors/", true);
            xmlHttpRequest.send();
        }
    </script>
</head>
<body onload="displaySensors()">
<div>
    <h1 class="display-4">Pi Sec</h1>
</div>

<div class="mx-auto" >

    <div id="sensors" class="card" style="float: left;">
        <div class="card-body">
            <h4 class="car-title test-center" >System Information</h4>
        </div>
        <div>
            <ul  id="list" class="list-group list-group-flush"></ul>
            <ul  class="list-group list-group-flush">
                <!--button-->
                <button type="button" class="btn btn-square btn-danger" onclick="displaySensors()">Reload</button>
            </ul>
        </div>

    </div>

    <div id="settings" class="card"  style="float: right;margin-right: 25px;">
        <div class="card-body">
            <h4 class="car-title test-center">Settings</h4>
        </div>
        <div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <div style="width: 63%; float: right;">
                        <button type="button" class="btn btn-info" onclick="armdisarm()"> ARM/DISARM <br> SYSTEM </button>
                    </div>
                </li>

                <li class="list-group-item">
                    <div style="width: 63%; float: right;">
                        <button type="button" class="btn btn-info" > CHANGE PIN </button>
                    </div>
                </li>
                <li class="list-group-item">
                    <div style="width: 63%; float: right; margin-bottom: 10px;">
                        <button type="button" class="btn btn-warning" onclick="location.href='/emails'"> Edit emails </button>
                    </div>
                </li>
            </ul>
        </div>

    </div>

</div>

</body>
</html>